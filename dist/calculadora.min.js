/**
 * Calculadora con capacidad de almacenar variables.
 * @version v1.0.0
 * @link http://ricky6982.github.io/me
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(a,b){function c(a,b){function c(g,h,i){var j,k,l;if(i.indexOf(g)>=0)throw"Referencia ciclica en "+JSON.stringify(g);if(!f[h]){if(f[h]=!0,j=b.filter(function(a){return a[0]===g}),h=j.length){k=i.concat(g);do l=j[--h][1],c(l,a.indexOf(l),k);while(h)}e[--d]=g}}for(var d=a.length,e=new Array(d),f={},g=d;g--;)f[g]||c(a[g],g,[]);return e}function d(a){for(var b=[],c=0,d=a.length;d>c;c++){var e=a[c];b.indexOf(e[0])<0&&b.push(e[0]),b.indexOf(e[1])<0&&b.push(e[1])}return b}function e(a){try{return c(d(a),a),cyclicDependencyIn="",!1}catch(b){return cyclicDependencyIn=b,!0}}function g(a){var c=[];return b.forEach(a,function(a,d){b.forEach(a,function(a){c.push([a,d])})}),c}function h(a){a=" "+a+" ";var b=a.replace(/[-!$%^&*+|~=`{}()\[\]:";'<>?,\/]/g,"  ").replace(/\s[0-9]+(\.[0-9]+)?\s/g,"  ").replace(/\s\s+/g,"  ").split(" ");return b=$.unique(b.filter(Boolean))}function i(a){var c={};return b.forEach(a,function(a,b){c[b]=h(a)}),c}function j(a,c){function d(){o.success=[],o.warning=[],o.danger=[],o.info=[]}function j(a){return objDep=i(a),!e(g(objDep))}function k(a,c){var d=b.copy(a);return dependencias=h(d),dependencias.length>0&&b.forEach(dependencias,function(a){var b=new RegExp(a,"g");subDependency=" ( "+k(n[a],c)+" ) ",d=d.replace(b,subDependency)}),d}function l(a){return"undefined"!=typeof n[a]}function m(a){return objDep=i(n),depends=!1,b.forEach(objDep,function(b,c){-1!=b.indexOf(a)&&(depends=!0)}),depends}var n={},o={success:[],danger:[],warning:[],info:[]};return calcular=function(a){try{objDep=i(n),f=k(a,objDep),resultado=c("{{ "+f+" }}")()}catch(b){return!1}return resultado},addVar=function(a,c){if(d(),"undefined"==typeof c&&(c=""),l(a))return o.warning.push("La variable ya esta definida"),!1;var e=b.copy(n);return e[a]=c,j(e)?(n[a]=c,!0):(o.danger.push(cyclicDependencyIn),!1)},editVar=function(a,c){if(d(),""===c.trim)return o.danger.push("La formula no esta definida correctamente."),!1;var e=b.copy(n);return e[a]=c,j(e)?(n[a]=c,o.info.push("Se actualizo la formula de la variable "+a),!0):(o.danger.push(cyclicDependencyIn),!1)},deleteVar=function(a){d(),l(a)&&(m(a)?o.warning.push("La variable "+a+" no puede ser eliminada porque existen otras variables que la necesitan para realizar sus calculos."):delete n[a])},{variables:n,existVar:l,addVar:addVar,editVar:editVar,deleteVar:deleteVar,calcular:calcular,notificaciones:o}}function k(){return{restrict:"AE",replace:!0,templateUrl:"template/calculadora.tpl.html",scope:{},controller:["$scope","Calculadora","Slug",function(a,b,c){function d(){a.alert={info:[],danger:[],success:[],warning:[]}}a.formula="",a.resultado="",a.modoEdicion=!1,a.editVar="",a.nombreVariable="",a.variables=b.variables,a.alert={info:[],danger:[],success:[],warning:[]};var e="";a.Calc={calcular:function(a){return b.calcular(a)}},a.calcular=function(){return""===a.formula.trim()?(a.resultado="",!0):b.calcular(a.formula)?(a.resultado=b.calcular(a.formula),!0):(a.alert.warning.push("La formula no esta bien definida."),a.resultado="",!1)},a.guardar=function(){return d(),a.nombreVariable=c.slugify(a.nombreVariable),b.existVar(a.nombreVariable)?(a.alert.danger.push("El nombre de la variable ya fue definido."),!1):""===a.formula.trim()?(a.alert.danger.push("La formula esta vacia."),a.resultado="",!1):""===a.nombreVariable.trim()?(a.alert.warning.push("Debe establecer un nombre para la variable."),!1):a.calcular()?void(b.addVar(a.nombreVariable,a.formula)?(a.alert.success.push("La variable se guardo correctamente."),a.nombreVariable=""):(a.alert.danger.push("La variable no se guardo."),a.alert.danger=a.alert.danger.concat(b.notificaciones.danger).concat(b.notificaciones.warning))):!1},a.insertarAFormula=function(b){a.formula=a.formula+b},a.borrarFormula=function(){a.formula=""},a.keyPress=function(b){a.formula+=b},a.update=function(){d(),b.editVar(a.editVar,a.formula),a.alert.warning=b.notificaciones.warning,a.alert.danger=b.notificaciones.danger,a.alert.info=b.notificaciones.info,a.modoNormal()},a.editar=function(b){a.modoEdicion||(e=a.formula,a.formula=a.variables[b]),a.modoEdicion=!0,a.editVar=b,a.calcular()},a.eliminar=function(c){d(),b.deleteVar(c),a.alert.warning=a.alert.warning.concat(b.notificaciones.warning),a.alert.danger=a.alert.danger.concat(b.notificaciones.danger)},a.modoNormal=function(){a.modoEdicion=!1,a.editVar="",a.formula=e,a.calcular()},a.clearAlert=function(){d()}}]}}!function(){"use strict";function a(a){if(!a)return"";for(var b,c,e=[],f=0;f<a.length;f++)(c=a.charCodeAt(f))<384&&(b=String.fromCharCode(c),e.push(d[b]||b));return a=e.join(""),a=a.replace(/[^\w\s-]/g,"").trim().toLowerCase(),a.replace(/[-\s]+/g,"_")}var c=b.module("slugifier_rck",[]),d={" ":" ","¡":"!","¢":"c","£":"lb","¥":"yen","¦":"|","§":"SS","¨":'"',"©":"(c)","ª":"a","«":"<<","¬":"not","­":"-","®":"(R)","°":"^0","±":"+/-","²":"^2","³":"^3","´":"'","µ":"u","¶":"P","·":".","¸":",","¹":"^1","º":"o","»":">>","¼":" 1/4 ","½":" 1/2 ","¾":" 3/4 ","¿":"?","À":"`A","Á":"'A","Â":"^A","Ã":"~A","Ä":'"A',"Å":"A","Æ":"AE","Ç":"C","È":"`E","É":"'E","Ê":"^E","Ë":'"E',"Ì":"`I","Í":"'I","Î":"^I","Ï":'"I',"Ð":"D","Ñ":"~N","Ò":"`O","Ó":"'O","Ô":"^O","Õ":"~O","Ö":'"O',"×":"x","Ø":"O","Ù":"`U","Ú":"'U","Û":"^U","Ü":'"U',"Ý":"'Y","Þ":"Th","ß":"ss","à":"`a","á":"'a","â":"^a","ã":"~a","ä":'"a',"å":"a","æ":"ae","ç":"c","è":"`e","é":"'e","ê":"^e","ë":'"e',"ì":"`i","í":"'i","î":"^i","ï":'"i',"ð":"d","ñ":"~n","ò":"`o","ó":"'o","ô":"^o","õ":"~o","ö":'"o',"÷":":","ø":"o","ù":"`u","ú":"'u","û":"^u","ü":'"u',"ý":"'y","þ":"th","ÿ":'"y',"Ā":"A","ā":"a","Ă":"A","ă":"a","Ą":"A","ą":"a","Ć":"'C","ć":"'c","Ĉ":"^C","ĉ":"^c","Ċ":"C","ċ":"c","Č":"C","č":"c","Ď":"D","ď":"d","Đ":"D","đ":"d","Ē":"E","ē":"e","Ĕ":"E","ĕ":"e","Ė":"E","ė":"e","Ę":"E","ę":"e","Ě":"E","ě":"e","Ĝ":"^G","ĝ":"^g","Ğ":"G","ğ":"g","Ġ":"G","ġ":"g","Ģ":"G","ģ":"g","Ĥ":"^H","ĥ":"^h","Ħ":"H","ħ":"h","Ĩ":"~I","ĩ":"~i","Ī":"I","ī":"i","Ĭ":"I","ĭ":"i","Į":"I","į":"i","İ":"I","ı":"i","Ĳ":"IJ","ĳ":"ij","Ĵ":"^J","ĵ":"^j","Ķ":"K","ķ":"k","Ĺ":"L","ĺ":"l","Ļ":"L","ļ":"l","Ľ":"L","ľ":"l","Ŀ":"L","ŀ":"l","Ł":"L","ł":"l","Ń":"'N","ń":"'n","Ņ":"N","ņ":"n","Ň":"N","ň":"n","ŉ":"'n","Ō":"O","ō":"o","Ŏ":"O","ŏ":"o","Ő":'"O',"ő":'"o',"Œ":"OE","œ":"oe","Ŕ":"'R","ŕ":"'r","Ŗ":"R","ŗ":"r","Ř":"R","ř":"r","Ś":"'S","ś":"'s","Ŝ":"^S","ŝ":"^s","Ş":"S","ş":"s","Š":"S","š":"s","Ţ":"T","ţ":"t","Ť":"T","ť":"t","Ŧ":"T","ŧ":"t","Ũ":"~U","ũ":"~u","Ū":"U","ū":"u","Ŭ":"U","ŭ":"u","Ů":"U","ů":"u","Ű":'"U',"ű":'"u',"Ų":"U","ų":"u","Ŵ":"^W","ŵ":"^w","Ŷ":"^Y","ŷ":"^y","Ÿ":'"Y',"Ź":"'Z","ź":"'z","Ż":"Z","ż":"z","Ž":"Z","ž":"z","ſ":"s"};c.factory("Slug",function(){return{slugify:a}}),c.directive("slug",["Slug",function(a){return{restrict:"E",scope:{to:"="},transclude:!0,replace:!0,template:"<div ng-transclude></div>",link:function(b,c,d){if(!d.from)throw"must set attribute 'from'";b.$parent.$watch(d.from,function(c){b.to=a.slugify(c)})}}}]),c.filter("slugify",["Slug",function(a){return function(b){return a.slugify(b)}}])}(),b.module("calculadora.templates",["template/calculadora.tpl.html"]),b.module("template/calculadora.tpl.html",[]).run(["$templateCache",function(a){a.put("template/calculadora.tpl.html",'<div class="well" style="max-width: 900px;">\n    <!-- Modo Normal -->\n    <div class="form-group">\n        <label ng-hide="modoEdicion">Formula:</label>\n        <label ng-show="modoEdicion">{{ editVar }}:</label>\n        <div class="input-group">\n            <input type="text" class="form-control input-lg" ng-model="formula" spellcheck="false">\n            <div class="input-group-btn">\n                <button class="btn btn-default input-lg" type="button" ng-click="calcular()">=</button>\n                <button class="btn btn-default input-lg dropdown-toggle" data-toggle="dropdown" ng-hide="modoEdicion">\n                    <span class="caret"></span>\n                    <span class="sr-only">Toggle Dropdown</span>\n                </button>\n                <ul class="dropdown-menu dropdown-menu-right">\n                    <li><a data-toggle="collapse" href="#collapseSaveFormula"><i class="glyphicon glyphicon-floppy-disk"></i> Guardar Formula</a></li>\n                    <li><a ng-click="borrarFormula()"><i class="glyphicon glyphicon-erase"></i> Borrar Formula</a></li>\n                </ul>\n            </div>\n        </div>\n    </div>\n    <div style="height: 1px; position: relative; z-index: 2000;">\n        <div class="collapse" id="collapseSaveFormula" style="box-shadow: black 0px 0px 40px -10px;">\n            <div class="panel panel-default">\n                <div class="panel-heading">Guardar Formula</div>\n                <div class="panel-body">\n                    <div class="form-group">\n                        <label>Nombre de Variable</label>\n                        <input type="text" class="form-control" ng-model="nombreVariable">\n                    </div>\n                    <div class="form-group text-center">\n                        <button class="btn btn-primary" data-toggle="collapse" href="#collapseSaveFormula" ng-click="guardar()">Guardar</button>\n                        <button class="btn btn-danger" data-toggle="collapse" href="#collapseSaveFormula">Cancelar</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="row form-group">\n        <!-- Teclas de Variables -->\n        <div class="col-sm-6">\n            <legend>Variables</legend>\n            <div ng-repeat="(key, value) in variables" style="margin-bottom: 3px;">\n                <div class="btn-group">\n                    <button type="button" class="btn btn-info" ng-click="insertarAFormula(key)">{{ key }}</button>\n                    <button type="button" ng-hide="modoEdicion" class="btn btn-info dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\n                        <span class="caret"></span>\n                        <span class="sr-only">Toggle Dropdown</span>\n                    </button>\n                    <ul class="dropdown-menu">\n                        <li class="text-center">Valor: {{ Calc.calcular(value) }}</li>\n                        <li role="separator" class="divider"></li>\n                        <li><a href="#" ng-click="editar(key)"><i class="glyphicon glyphicon-pencil text-primary"></i> Editar</a></li>\n                        <li><a href="#" ng-click="eliminar(key)"><i class="glyphicon glyphicon-trash text-danger"></i> Eliminar</a></li>\n                    </ul>\n                </div>\n            </div>\n        </div>\n        <!-- Teclado Numerico -->\n        <div class="col-sm-6">\n            <div class="form-inline form-group text-right">\n                <label for="">Resultado</label>\n                <input type="text" ng-model="resultado" class="form-control text-center" disabled>\n            </div>\n            <div class="text-center" style="margin-bottom: px;">\n                <button ng-click="keyPress(\'7\')" class="btn btn-default" style="width: 40px; margin: 2px;">7</button>\n                <button ng-click="keyPress(\'8\')" class="btn btn-default" style="width: 40px; margin: 2px;">8</button>\n                <button ng-click="keyPress(\'9\')" class="btn btn-default" style="width: 40px; margin: 2px;">9</button>\n                <button ng-click="keyPress(\'(\')" class="btn btn-default" style="width: 40px; margin: 2px;">(</button>\n                <button ng-click="keyPress(\')\')" class="btn btn-default" style="width: 40px; margin: 2px;">)</button>\n            </div>\n            <div class="text-center" style="margin-bottom: px;">\n                <button ng-click="keyPress(\'4\')" class="btn btn-default" style="width: 40px; margin: 2px;">4</button>\n                <button ng-click="keyPress(\'5\')" class="btn btn-default" style="width: 40px; margin: 2px;">5</button>\n                <button ng-click="keyPress(\'6\')" class="btn btn-default" style="width: 40px; margin: 2px;">6</button>\n                <button ng-click="keyPress(\'/\')" class="btn btn-default" style="width: 40px; margin: 2px;">/</button>\n                <button ng-click="keyPress(\'*\')" class="btn btn-default" style="width: 40px; margin: 2px;">*</button>\n            </div>\n            <div class="text-center" style="margin-bottom: px;">\n                <button ng-click="keyPress(\'1\')" class="btn btn-default" style="width: 40px; margin: 2px;">1</button>\n                <button ng-click="keyPress(\'2\')" class="btn btn-default" style="width: 40px; margin: 2px;">2</button>\n                <button ng-click="keyPress(\'3\')" class="btn btn-default" style="width: 40px; margin: 2px;">3</button>\n                <button ng-click="keyPress(\'-\')" class="btn btn-default" style="width: 40px; margin: 2px;">-</button>\n                <button ng-click="keyPress(\'+\')" class="btn btn-default" style="width: 40px; margin: 2px;">+</button>\n            </div>\n            <div class="text-center" style="margin-bottom: px;">\n                <button ng-click="keyPress(\'0\')" class="btn btn-default" style="width: 88px; margin: 2px;">0</button>\n                <button ng-click="keyPress(\'.\')" class="btn btn-default" style="width: 40px; margin: 2px;">.</button>\n                <button class="btn btn-default" style="width: 88px; margin: 2px;" ng-click="calcular()">=</button>\n            </div>\n            <!-- Modo Edición -->\n            <div class="row">\n                <div class="col">\n                    <div ng-show="modoEdicion">\n                        <div class="form-group">\n                            <button class="btn btn-primary" ng-click="update()">Guardar cambios</button>\n                            <button class="btn btn-primary" ng-click="modoNormal()">Modo Normal</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <!-- Alert Success -->\n    <div ng-show="alert.success.length > 0" class="alert alert-success alert-dismissible" role="alert">\n        <button ng-click="clearAlert()" type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <strong>Todo bien!</strong>\n        <ul>\n            <li ng-repeat="msj in alert.success">{{ msj }}</li>\n        </ul>\n    </div>\n    <!-- Alert Danger -->\n    <div ng-show="alert.danger.length > 0" class="alert alert-danger alert-dismissible" role="alert">\n        <button ng-click="clearAlert()" type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <strong>Algo salio mal</strong>\n        <ul>\n            <li ng-repeat="msj in alert.danger">{{ msj }}</li>\n        </ul>\n    </div>\n    <!-- Alert Info -->\n    <div ng-show="alert.info.length > 0" class="alert alert-info alert-dismissible" role="alert">\n        <button ng-click="clearAlert()" type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <strong>Información</strong>\n        <ul>\n            <li ng-repeat="msj in alert.info">{{ msj }}</li>\n        </ul>\n    </div>\n    <!-- Alert Info -->\n    <div ng-show="alert.warning.length > 0" class="alert alert-warning alert-dismissible" role="alert">\n        <button ng-click="clearAlert()" type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <strong>Precaución</strong>\n        <ul>\n            <li ng-repeat="msj in alert.warning">{{ msj }}</li>\n        </ul>\n    </div>\n</div>\n')}]),b.module("calculadora",["calculadora.templates","slugifier_rck"]),j.$inject=["$parse","$interpolate"],b.module("calculadora").factory("Calculadora",j),b.module("calculadora").directive("calculadora",k)}(window,angular);