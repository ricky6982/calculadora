/**
 * Calculadora con capacidad de almacenar variables.
 * @version v1.0.0
 * @link http://ricky6982.github.io/me
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(a,b){function c(a,b){function c(g,h,i){var j,k,l;if(i.indexOf(g)>=0)throw"Referencia ciclica en "+JSON.stringify(g);if(!f[h]){if(f[h]=!0,j=b.filter(function(a){return a[0]===g}),h=j.length){k=i.concat(g);do l=j[--h][1],c(l,a.indexOf(l),k);while(h)}e[--d]=g}}for(var d=a.length,e=new Array(d),f={},g=d;g--;)f[g]||c(a[g],g,[]);return e}function d(a){for(var b=[],c=0,d=a.length;d>c;c++){var e=a[c];b.indexOf(e[0])<0&&b.push(e[0]),b.indexOf(e[1])<0&&b.push(e[1])}return b}function e(a){try{return c(d(a),a),cyclicDependencyIn="",!1}catch(b){return cyclicDependencyIn=b,!0}}function g(a){var c=[];return b.forEach(a,function(a,d){b.forEach(a,function(a){c.push([a,d])})}),c}function h(a){a=" "+a+" ";var b=a.replace(/[-!$%^&*+|~=`{}()\[\]:";'<>?,\/]/g,"  ").replace(/\s[0-9]+(\.[0-9]+)?\s/g,"  ").replace(/\s\s+/g,"  ").split(" ");return b=$.unique(b.filter(Boolean))}function i(a){var c={};return b.forEach(a,function(a,b){c[b]=h(a)}),c}function j(a,c){function d(a){return objDep=i(a),!e(g(objDep))}function j(a,c){var d=b.copy(a);return dependencias=h(d),dependencias.length>0&&b.forEach(dependencias,function(a){var b=new RegExp(a,"g");subDependency=" ( "+j(l[a],c)+" ) ",d=d.replace(b,subDependency)}),d}var k,l={};return calcular=function(a){return objDep=i(l),f=j(a,objDep),resultado=c("{{ "+f+" }}")(),resultado},existVar=function(a){return"undefined"!=typeof l[a]},addVar=function(a,c){return k="","undefined"==typeof c&&(c=""),existVar(a)?(k="La variable ya esta definida",!1):(aux=b.copy(l),aux[a]=c,d(aux)?(l[a]=c,!0):(k=cyclicDependencyIn,console.log(k),!1))},editVar=function(a,b){},deleteVar=function(a,b){},{variables:l,existVar:existVar,addVar:addVar,editVar:editVar,deleteVar:deleteVar,calcular:calcular}}function k(){return{restrict:"AE",replace:!0,templateUrl:"template/calculadora.tpl.html",scope:{},controller:["$scope","Calculadora",function(a,b){function c(){a.alert={danger:[],success:[]}}a.formula="",a.resultado="",a.modoEdicion=!1,a.editVar="",a.variables=b.variables,a.alert={danger:[],success:[]};var d="";a.calcular=function(){a.resultado=b.calcular(a.formula)},a.guardar=function(){return c(),b.existVar(a.nombreVariable)?(a.alert.danger.push("El nombre de la variable ya fue definido."),!1):""===a.formula.trim()?(a.alert.danger.push("La formula esta vacia."),!1):void(b.addVar(a.nombreVariable,a.formula)?a.alert.success.push("La variable se guardo correctamente."):a.alert.danger.push("La variable no se guardo."))},a.editar=function(b){a.modoEdicion||(d=a.formula,a.formula=a.variables[b]),a.modoEdicion=!0,a.editVar=b},a.eliminar=function(){},a.modoNormal=function(){a.modoEdicion=!1,a.editVar="",a.formula=d},a.clearAlert=function(){c()}}]}}b.module("calculadora.templates",["template/calculadora.tpl.html"]),b.module("template/calculadora.tpl.html",[]).run(["$templateCache",function(a){a.put("template/calculadora.tpl.html",'<div class="row well">\n    <div class="col-sm-6">\n        <div ng-hide="modoEdicion">\n          <!-- Modo EdiciÃ³n -->\n          <div class="form-group">\n              <input type="text" ng-model="formula" class="form-control input-lg">\n          </div>\n          <div class="form-inline form-group">\n              <label for="">Nombre de la variable</label>\n              <input type="text" ng-model="nombreVariable" class="form-control">\n              <button ng-click="guardar()">Guardar</button>\n          </div>\n        </div>\n        <div ng-show="modoEdicion">\n          <!-- Modo Normal -->\n          <div class="form-inline form-group">\n              <label for="">{{ editVar }}</label>\n              <input type="text" ng-model="formula" class="form-control input-lg" disabled>\n          </div>\n          <div class="form-group">\n              <button>Guardar cambios</button>\n              <button ng-click="modoNormal()">Modo Normal</button>\n          </div>\n        </div>\n\n        <div class="form-inline form-group">\n            <label for="">Resultado</label>\n            <input type="text" ng-model="resultado" class="form-control" disabled>\n        </div>\n\n        <div class="row">\n            <!-- Teclado Numerico -->\n            <div class="col-sm-6">\n                <button>7</button><button>8</button><button>9</button><button>/</button><button>(</button> <br>\n                <button>4</button><button>5</button><button>6</button><button>*</button><button>)</button> <br>\n                <button>1</button><button>2</button><button>3</button><button>-</button> <br>\n                <button>0</button><button>+</button><button ng-click="calcular()">=</button>\n            </div>\n            <!-- Teclas de Variables -->\n            <div class="col-sm-6" ng-hide="modoEdicion">\n                <legend>Variables</legend>\n                <div ng-repeat="(key, value) in variables">\n                    <button>{{ key }}</button>\n                    <button ng-click="editar(key)"><i class="glyphicon glyphicon-pencil"></i></button>\n                    <button ng-click="eliminar(key)"><i class="glyphicon glyphicon-trash"></i></button>\n                </div>\n            </div>\n        </div>\n\n        <div ng-show="alert.success.length > 0" class="alert alert-success alert-dismissible" role="alert">\n          <button ng-click="clearAlert()" type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n          <strong>Todo bien!</strong>\n          <ul>\n            <li ng-repeat="msj in alert.success">{{ msj }}</li>\n          </ul>\n        </div>\n\n        <div ng-show="alert.danger.length > 0" class="alert alert-danger alert-dismissible" role="alert">\n          <button ng-click="clearAlert()" type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n          <strong>Algo salio mal</strong>\n          <ul>\n            <li ng-repeat="msj in alert.danger">{{ msj }}</li>\n          </ul>\n        </div>\n    </div>\n</div>')}]),b.module("calculadora",["calculadora.templates"]),j.$inject=["$parse","$interpolate"],b.module("calculadora").factory("Calculadora",j),b.module("calculadora").directive("calculadora",k)}(window,angular);