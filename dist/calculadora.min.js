/**
 * Calculadora con capacidad de almacenar variables.
 * @version v1.0.0
 * @link http://ricky6982.github.io/me
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(a,b){function c(a,b){function c(g,h,i){var j,k,l;if(i.indexOf(g)>=0)throw"Referencia ciclica en "+JSON.stringify(g);if(!f[h]){if(f[h]=!0,j=b.filter(function(a){return a[0]===g}),h=j.length){k=i.concat(g);do l=j[--h][1],c(l,a.indexOf(l),k);while(h)}e[--d]=g}}for(var d=a.length,e=new Array(d),f={},g=d;g--;)f[g]||c(a[g],g,[]);return e}function d(a){for(var b=[],c=0,d=a.length;d>c;c++){var e=a[c];b.indexOf(e[0])<0&&b.push(e[0]),b.indexOf(e[1])<0&&b.push(e[1])}return b}function e(a){try{return c(d(a),a),cyclicDependencyIn="",!1}catch(b){return cyclicDependencyIn=b,!0}}function f(a){var c=[];return b.forEach(a,function(a,d){b.forEach(a,function(a){c.push([a,d])})}),c}function g(a){var c={};return b.forEach(a,function(a,b){a=" "+a+" ";var d=a.replace(/[-!$%^&*+|~=`{}\[\]:";'<>?,\/]/g," ").replace(/\s[0-9]+(\.[0-9]+)?\s/g," ").replace(/\s\s+/g," ").split(" ");d=$.unique(d.filter(Boolean)),c[b]=d}),c}function h(a){function c(a){return objDep=g(a),!e(f(objDep))}var d,h={};return calcular=function(b){return processFormula(b)?a.$eval(b):"Error"},addVar=function(a,e){return d="","undefined"==typeof e&&(e=""),"undefined"!=typeof h[a]?(d="La variable ya esta definida",!1):(aux=b.copy(h),aux[a]=e,c(aux)?(h[a]=e,!0):(d=cyclicDependencyIn,console.log(d),!1))},editVar=function(a,b){},deleteVar=function(a,b){},{variables:h,addVar:addVar,editVar:editVar,deleteVar:deleteVar,calcular:calcular}}function i(a){return{restrict:"AE",replace:!0,templateUrl:"template/calculadora.tpl.html",controller:"calculadoraCtrl"}}b.module("calculadora.templates",["template/calculadora.tpl.html"]),b.module("template/calculadora.tpl.html",[]).run(["$templateCache",function(a){a.put("template/calculadora.tpl.html",'<div class="row well">\n    <h1>Calculadora</h1>\n    <div class="col-sm-6">\n        <div ng-hide="modoEdicion">\n          <!-- Modo EdiciÃ³n -->\n          <div class="form-group">\n              <input type="text" ng-model="formula" class="form-control input-lg" disabled>\n          </div>\n          <div class="form-inline form-group">\n              <label for="">Nombre de la variable</label>\n              <input type="text" ng-model="nombreVariable" class="form-control">\n              <button ng-click="guardar()">Guardar</button>\n          </div>\n        </div>\n        <div ng-show="modoEdicion">\n          <!-- Modo Normal -->\n          <div class="form-inline form-group">\n              <label for="">{{ editVar }}</label>\n              <input type="text" ng-model="formula" class="form-control input-lg" disabled>\n          </div>\n          <div class="form-group">\n              <button>Guardar cambios</button>\n              <button ng-click="modoNormal()">Volver a modo normal</button>\n          </div>\n        </div>\n\n        <div class="form-inline form-group">\n            <label for="">Resultado</label>\n            <input type="text" ng-model="resultado" class="form-control" disabled>\n        </div>\n\n        <div class="row">\n            <!-- Teclado Numerico -->\n            <div class="col-sm-6">\n                <button>7</button><button>8</button><button>9</button><button>/</button><button>(</button> <br>\n                <button>4</button><button>5</button><button>6</button><button>*</button><button>)</button> <br>\n                <button>1</button><button>2</button><button>3</button><button>-</button> <br>\n                <button>0</button><button>+</button><button ng-click="calcular()">=</button>\n            </div>\n            <!-- Teclas de Variables -->\n            <div class="col-sm-6">\n                <legend>Variables</legend>\n                <div ng-repeat="(key, value) in variables">\n                    <button>{{ key }}</button><button ng-click="editar(key)"><i class="glyphicon glyphicon-pencil"></i></button>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>')}]),b.module("calculadora",["calculadora.templates"]),h.$inject=["$rootScope"],b.module("calculadora").factory("Calculadora",h),b.module("calculadora").controller("calculadoraCtrl",["$scope","Calculadora",function(a,b){a.formula="6*5",a.modoEdicion=!1,a.editVar="",a.variables=b.variables,a.calcular=function(){a.resultado=Calc.calcular(a.formula)},a.guardar=function(){b.addVar(a.nombreVariable,a.formula)},a.editar=function(b){a.modoEdicion=!0,a.editVar=b,a.formula=a.variables[b]},a.modoNormal=function(){a.modoEdicion=!1,a.editVar="",a.formula=""}}]),i.$inject=["$injector"],b.module("calculadora").directive("calculadora",i)}(window,angular);